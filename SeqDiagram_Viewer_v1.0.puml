@startuml
title Видеохостинг - Диаграмма взаимодействия UC1.1.1 Найти видео на платформе и UC1.1.2 Просмотреть видео
actor "Зритель" as Viewer
' 1. Клиентский уровень
box "Client layer"
    participant "Web UI" as UI
    participant "Video Player" as VideoPlayer
end box
' 2. Backend
box "Backend API layer"
    participant "API Gateway" as API
end box
' 3. Сервисы
box "Services"
    participant "Auth Service" as AuthService
    participant "User Service" as UserService
    participant "Video Management Service" as VideoManagementService
    participant "Search Service" as SearchService
    participant "Streaming Service" as StreamingService
    participant "Like Service" as LikeService
    participant "Comment Service" as CommentService
    participant "Statistics Service" as StatisticsService
end box
' 4. Обработка видео
participant "Upload Service" as UploadService
participant "Transcoding Service" as TranscodingService
participant "Message Queue" as MQ
' 5. Инфраструктура
box "Infrastructure"
    participant "User DB" as UserDB
    participant "Video Metadata DB" as MetadataDB
    participant "Object Storage" as ObjectStorage
    participant "CDN" as CDN
end box

==UC3.1.1 Войти в личный кабинет==

autonumber 1.1

Viewer -> UI : Открыть страницу входа
UI --> Viewer : Отобразить страницу входа

Viewer -> UI : Ввести данные для входа и подтвердить вход
UI -> API : 
API -> AuthService : checkAuth()
AuthService --> API : OK
API -->

UI -> API : GET /api/upload
API -> AuthService : checkAuth()
AuthService -> API : OK
API --> UI: Предоставить доступ
UI --> Author : Отобразить форму загрузки

Author -> UI : Выбрать видеофайл
UI -> API : POST /api/upload/video
API -> UploadService : videoUpload()
UploadService --> API : uploadId

loop Загрузка чанков (resumable)
    UI -> UploadService : uploadchunk(uploadId, chunk)
    UploadService -> ObjectStorage : saveChanunk()
end loop

UI -> API : POST /api/video/metadata
API -> VideoManagementService : saveMetadata()
VideoManagementService -> MetadataDB : Вставить видеофайл

UploadService -> MQ : publishTrancscodeTask(videoId)
MQ -> TranscodingService : consume Task
TranscodingService -> ObjectStorage : read original video
TranscodingService -> ObjectStorage : save bitrates
TranscodingService -> CDN : publish video

@enduml